/* ===========================================================
   NodeSmith â€¢ App styles layered on top of Paradox-Grid
   (merged with GridFlow theme + bridge tweaks)
   =========================================================== */

/* ---------- NodeSmith variables ---------- */
:root{
  --ns-bg: #0e0f11;
  --ns-panel: #15171a;
  --ns-muted: #2a2d33;
  --ns-text: #e6e8eb;
  --ns-accent: #00dd11;
  --ns-accent-2: #6fff7a;
  --ns-border: #1f2227;
  --ns-shadow: 0 10px 30px rgba(0,0,0,.35);

  /* Layout metrics */
  --header-h: 60px;
  --footer-h: 56px;
  --rail-w: 64px;
  --slideout-w: 240px;
  --gutter: 12px;

  /* Colors */
  --rail-bg: #1b1f26;
  --slideout-bg: #101318;
  --slideout-border: #2c3139;
}

/* ---------- GridFlow theme variables (merged) ---------- */
:root {
  --bg: #0b0c0e;             /* harmonized with NodeSmith */
  --fg: #e6e8eb;
  --muted: #2a2d33;
  --accent: #6fff7a;
  --accent-2: #00dd11;
  --danger: #ef4444;
  --focus: #6fff7a;
  --grid: #1b1f26;
  --wire: #6bb6ff;
  --wire-exec: #ffd33d;      /* amber for control-flow */
  --hc-bg: #000000;
  --hc-fg: #ffffff;
  --ring: 2px solid var(--focus);
  --shadow: 0 8px 24px rgba(0,0,0,.35);
  --radius: 12px;
  --grid-size: 20px;
}

/* ---------- Resets ---------- */
*,*::before,*::after { box-sizing: border-box; }
html, body { height: 100%; }
body { margin: 0; background: var(--ns-bg); color: var(--ns-text); font: 14px/1.4 system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
a { color: inherit; text-decoration: none; }
.hidden { display:none !important; }
:focus-visible { outline: var(--ring); outline-offset: 2px; }
kbd { border:1px solid #888; border-bottom-width:2px; padding:1px 4px; border-radius:6px; background:#0003; }

/* ---------- Header ---------- */
header.hero {
  height: var(--header-h);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 12px;
  border-bottom: 1px solid var(--ns-muted);
  background: var(--ns-panel);
}
header.hero #header-left { display:flex; align-items:center; gap:10px; }
header.hero #header-right { display:flex; align-items:center; gap:8px; }
header.hero .dot { width:10px; height:10px; border-radius:50%; background:var(--ns-accent); box-shadow:0 0 8px var(--ns-accent-2); }
header.hero .btn { background:transparent; border:1px solid var(--ns-muted); color:var(--ns-text); padding:6px 10px; border-radius:8px; cursor:pointer; }
header.hero .btn:hover { border-color: var(--ns-accent); }

/* ---------- Rails ---------- */
.rail {
  position: fixed;
  top: var(--header-h);
  bottom: var(--footer-h);
  width: var(--rail-w);
  background: var(--rail-bg);
  border-right: 1px solid var(--ns-border);
  z-index: 1350;
  display: flex; flex-direction: column; align-items: center;
  padding: 8px 6px; gap: 6px;
}
.rail-left { left: 0; }
.rail-right { right: 0; border-right: none; border-left: 1px solid var(--ns-border); }
.rail .rail-spacer { flex: 1 1 auto; }

.rail-btn {
  width: 100%; height: 48px;
  display: grid; align-items: center; justify-items: center; gap: 4px;
  color: #cfd3da; background: transparent; border: 1px solid transparent; border-radius: 10px; cursor: pointer; padding: 4px;
}
.rail-btn:hover, .rail-btn[aria-pressed="true"] {
  border-color: var(--ns-accent); box-shadow: 0 0 0 1px var(--ns-accent) inset; color: #e9edf3;
}
.rail-btn span { font-size: 10px; line-height: 1; opacity: .9; margin-top: 2px; }

/* ---------- Slideouts ---------- */
.slideout {
  position: fixed; top: var(--header-h); bottom: var(--footer-h);
  width: var(--slideout-w); background: var(--slideout-bg);
  z-index: 1300; box-shadow: var(--ns-shadow); transition: transform .18s ease-out;
  display: flex; flex-direction: column;
}
.slideout-left { left: var(--rail-w); border-right: 2px solid var(--slideout-border); transform: translateX(calc(-1 * var(--slideout-w))); }
.slideout-left.is-open { transform: translateX(0); }
.slideout-right { right: var(--rail-w); border-left: 2px solid var(--slideout-border); transform: translateX(var(--slideout-w)); }
.slideout-right.is-open { transform: translateX(0); }
.slideout[hidden] { display: block; visibility: hidden; }
.slideout.is-open { visibility: visible; }
.slideout__hdr { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-bottom: 1px solid var(--ns-border); }
.slideout__body { flex: 1 1 auto; overflow: auto; padding: 12px; }

/* ---------- Graph viewport & card ---------- */
.app { min-height: 100vh; display: grid; grid-template-rows: auto 1fr auto; }
.graph-viewport { position: relative; height: calc(100vh - var(--header-h) - var(--footer-h)); padding: var(--gutter); padding-left: calc(var(--gutter) + var(--rail-w)); padding-right: calc(var(--gutter) + var(--rail-w)); overflow: hidden; }
.canvas-card { background: var(--ns-panel); border: 1px solid var(--ns-border); border-radius: 12px; box-shadow: var(--ns-shadow); height: 100%; display: flex; flex-direction: column; min-height: 0; }
.card-hdr { display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid var(--ns-muted); }
.card-title { font-weight: 600; }
.canvas-body { flex:1 1 auto; padding:0; min-height:0; }
.canvas-wrap { position: relative; width: 100%; height: 100%; background: #0b0c0e; border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; overflow: hidden; }

/* ---------- Stage layers ---------- */
.grid-canvas { position:absolute; inset:0; z-index:1; }
.edge-canvas { position:absolute; inset:0; z-index:2; }
.node-layer  { position:absolute; inset:0; z-index:3; }
.marquee     { position:absolute; z-index:4; }
.minimap     { position:absolute; right:10px; bottom:10px; width:220px; height:140px; z-index:5; background:#0a0b0c; border:1px solid var(--ns-muted); border-radius:6px; opacity:.9; }
.minimap.hidden { display: none !important; }

/* ---------- Menus ---------- */
.menu { position: relative; }
.menu .btn { white-space: nowrap; }
.menu-panel {
  position: absolute; top: calc(100% + 6px); left: 0; min-width: 220px;
  background: #0b0c0e; border: 1px solid var(--ns-muted); border-radius: 10px; box-shadow: var(--ns-shadow);
  padding: 6px; z-index: 1500;
}
.menu-panel[hidden] { display: none; }
.menu-panel .menu-item { width: 100%; text-align: left; display: block; border: 1px solid transparent; background: transparent; color: var(--ns-text); border-radius: 8px; padding: 8px 10px; cursor: pointer; }
.menu-panel .menu-item:hover { border-color: var(--ns-accent); background: rgba(0,221,17,0.06); }
.menu-panel input[type="range"] { width: 120px; vertical-align: middle; accent-color: var(--ns-accent); }

/* ---------- Footer ---------- */
.app-footer {
  position: fixed; left: 0; right: 0; bottom: 0; height: var(--footer-h);
  display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 12px;
  padding: 8px 12px; background: var(--ns-panel); border-top: 1px solid var(--ns-muted); z-index: 1400;
}
.app-footer .footer-left, .app-footer .footer-right { display: flex; gap: 8px; align-items: center; justify-content: flex-end; }
.app-footer .footer-left { justify-content: flex-start; }
.app-footer .footer-center { text-align: center; opacity: .85; }
.app-footer .btn { background: transparent; border: 1px solid var(--ns-muted); color: var(--ns-text); padding: 6px 10px; border-radius: 8px; cursor: pointer; }
.app-footer .btn:hover { border-color: var(--ns-accent); }
.app-footer .btn.icon { padding: 6px; display: inline-flex; align-items: center; justify-content: center; }
.app-footer .zoom-label { min-width: 48px; text-align: right; font-variant-numeric: tabular-nums; opacity: .9; }
.app-footer .btn[aria-pressed="true"] { border-color: var(--ns-accent); box-shadow: 0 0 0 1px var(--ns-accent) inset; }

/* ---------- GridFlow node visuals (kept) ---------- */
.node {
  position:absolute; background:#141822; border:1px solid #2a2f3a; border-radius:var(--radius);
  min-width:220px; min-height:120px; box-shadow: var(--shadow);
  transition: box-shadow .12s ease, border-color .12s ease; overflow: hidden;
}
.node:focus-visible { outline: var(--ring); }
.node .title { display:flex; align-items:center; justify-content:space-between; padding:6px 8px; border-bottom:1px solid #2a2f3a; user-select:none; }
.node .title .menu-btn { width:28px; height:28px; border:1px solid #0006; border-radius:8px; background:#0000; color:var(--fg); display:grid; place-items:center; cursor:pointer; }
.node .title .menu-btn .ti { font-size: 16px; line-height: 1; }
.node .body { position: relative; padding: 8px; display: grid; grid-template-rows: auto 1fr; row-gap: 8px; height: calc(100% - 38px); }
.connectors { display:grid; grid-template-columns: 1fr 1fr; column-gap: 8px; align-items:start; }
.ports.incoming, .ports.outgoing { display:flex; flex-direction: column; gap:6px; }
.ports.incoming  { align-items: flex-start; } .ports.outgoing { align-items: flex-end; }
.port { display:inline-flex; align-items:center; gap:6px; white-space:nowrap; user-select:none; }
.port .dot { width:10px; height:10px; border-radius:50%; border:2px solid #000c; background:var(--accent); }
.port.exec .dot { border-radius: 2px; background: var(--wire-exec); }
.port.bad  .dot { background: var(--danger); }
.ports.incoming  .port span:last-child  { padding-left: 2px; }
.ports.outgoing  .port span:first-child { padding-right: 2px; }
.node-content { display:flex; flex-direction:column; gap:8px; min-height:60px; height:100%; }
.inline-field { display:flex; flex-direction:column; gap:6px; }
.inline-field.fill { flex: 1 1 auto; min-height: 0; }
.inline-field textarea, .inline-field input, .inline-field select { width: 100%; background:#0e1220; color:var(--fg); border:1px solid #0006; border-radius:8px; padding:6px 8px; }
.inline-field.fill textarea { flex: 1 1 auto; height: 100%; resize: none; }
.dialog-window { flex: 1 1 auto; min-height: 90px; overflow: auto; background:#0b0f1a; border:1px solid #2a2f3a; border-radius: 8px; padding:8px; }
.node.selected { border-color: var(--accent-2) !important; box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-2) 65%, transparent), var(--shadow) !important; }
.node.selected .title { border-bottom-color: color-mix(in srgb, var(--accent-2) 60%, #2a2f3a); }
.node .resize-handle { position:absolute; right:4px; bottom:4px; width:14px; height:14px; cursor: nwse-resize; opacity:.9; border-radius: 3px;
  background: linear-gradient(45deg, transparent 46%, #6b7280 46%, #6b7280 54%, transparent 54%), linear-gradient(45deg, transparent 66%, #9ca3af 66%, #9ca3af 74%, transparent 74%), linear-gradient(45deg, transparent 86%, #d1d5db 86%, #d1d5db 94%, transparent 94%); }

/* ---------- Modal base (NodeSmith) ---------- */
.modal[hidden] { display:none; }
.modal { position:fixed; inset:0; z-index:2000; display:flex; align-items:center; justify-content:center; }
.modal__scrim { position:absolute; inset:0; background: rgba(0,0,0,.6); }
.modal__dialog { position:relative; width:min(960px, 96vw); background:#0b0c0e; border:1px solid var(--ns-muted); border-radius:12px; box-shadow: var(--ns-shadow); overflow:hidden; }
.modal__hdr, .modal__ftr { display:flex; align-items:center; justify-content:space-between; padding:12px; border-bottom:1px solid var(--ns-muted); }
.modal__ftr { border-top:1px solid var(--ns-muted); border-bottom:none; }
.modal__body { padding:14px; }
.modal__close { border:1px solid var(--ns-muted); background:transparent; color:var(--ns-text); border-radius:8px; cursor:pointer; padding:6px 10px; }
.modal-open { overflow:hidden; }

/* ---------- Settings modal layout ---------- */
.settings-dialog { width:min(1100px, 96vw); }
.settings-layout { display:grid; grid-template-columns: 220px 1fr; gap:0; }
.settings-actions { display:flex; gap:8px; align-items:center; }
.settings-tabs { display:flex; flex-direction: column; gap: 4px; background:#0f1216; border-right:1px solid var(--ns-muted); padding:10px; }
.settings-tab { text-align:left; border:1px solid transparent; background:transparent; color:var(--ns-text); border-radius:8px; padding:8px 10px; cursor:pointer; }
.settings-tab.active, .settings-tab:hover { border-color: var(--ns-accent); }
.settings-divider { border:none; border-top:1px solid var(--ns-muted); margin:8px 0; }
.settings-panel { display:none; padding:12px; min-height:360px; }
.settings-panel.active { display:block; }
.form-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:12px; margin-top:8px; }
.switch { display:flex; gap:8px; align-items:center; }
.switch input { width:auto; }
.ti {font-size: 1.65em; color: var(--wire);}
