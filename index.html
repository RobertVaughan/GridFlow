<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GridFlow ‚Äî Visual Node Framework</title>
  <meta name="theme-color" content="#0a0a0a">
  <link rel="stylesheet" href="css/theme.css">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'wasm-unsafe-eval'; connect-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self'">
</head>
<body data-theme="dark">
  <!-- Sticky Header -->
  <header class="app-header" role="banner">
    <div class="brand">GridFlow</div>
    <nav class="menubar" aria-label="Application Menu">
      <div class="menu">
        <button class="menu-btn" aria-haspopup="menu" aria-expanded="false">File</button>
        <div class="menu-drop" role="menu">
          <button role="menuitem" id="mFileNew">New</button>
          <button role="menuitem" id="mFileOpen">Open‚Ä¶</button>
          <button role="menuitem" id="mFileSave">Save</button>
        </div>
      </div>
      <div class="menu">
        <button class="menu-btn" aria-haspopup="menu" aria-expanded="false">Edit</button>
        <div class="menu-drop" role="menu">
          <button role="menuitem" id="mEditUndo">Undo</button>
          <button role="menuitem" id="mEditRedo">Redo</button>
          <div class="divider"></div>
          <button role="menuitem" id="mEditCopy">Copy</button>
          <button role="menuitem" id="mEditPaste">Paste</button>
          <button role="menuitem" id="mEditDelete">Delete</button>
        </div>
      </div>
      <div class="menu">
        <button class="menu-btn" aria-haspopup="menu" aria-expanded="false">View</button>
        <div class="menu-drop" role="menu">
          <label class="menu-row"><input type="checkbox" id="mViewSnap" checked> Snap to Grid</label>
          <div class="menu-row">Grid size <input id="mViewGridSize" type="number" min="4" step="2" value="20" style="width:70px;margin-left:8px;"></div>
          <div class="divider"></div>
          <label class="menu-row"><input type="checkbox" id="mViewLinks" checked> Show Links</label>
          <label class="menu-row"><input type="checkbox" id="mViewMinimap" checked> Show Minimap</label>
          <div class="divider"></div>
          <div class="menu-row">
            Theme
            <select id="mViewTheme" style="margin-left:8px;">
              <option value="dark">Dark</option>
              <option value="light">Light</option>
              <option value="high-contrast">High Contrast</option>
            </select>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <main class="shell">
    <!-- Left Toolbar -->
    <aside class="rail left-rail" aria-label="Left toolbar">
      <button class="rail-btn" data-slide="nodes">
        <span class="ic" aria-hidden="true">‚ñ¶</span><span>Nodes</span>
      </button>
      <button class="rail-btn" data-slide="workflow">
        <span class="ic" aria-hidden="true">‚§≥</span><span>Workflow</span>
      </button>
      <button class="rail-btn" data-slide="custom">
        <span class="ic" aria-hidden="true">‚úö</span><span>Custom</span>
      </button>
      <div class="rail-spacer"></div>
      <button class="rail-btn" data-slide="settings" title="Settings" aria-label="Settings">
        <span class="ic" aria-hidden="true">‚öô</span><span>Settings</span>
      </button>
    </aside>

    <!-- Right Toolbar -->
    <aside class="rail right-rail" aria-label="Right toolbar">
      <button class="rail-btn" data-slide="history">
        <span class="ic" aria-hidden="true">‚§∫</span><span>History</span>
      </button>
      <button class="rail-btn" data-slide="queue">
        <span class="ic" aria-hidden="true">‚ò∞</span><span>Queue</span>
      </button>
    </aside>

    <!-- Slideouts -->
    <section id="slideout-left" class="slideout left">
      <div class="slide-body" data-panel="nodes">
        <h2>Basic Nodes</h2>
        <div id="nodesList" class="list"></div>
      </div>
      <div class="slide-body" data-panel="workflow">
        <h2>Workflow</h2>
        <p>Coming soon: sequence, branch, join, loop‚Ä¶</p>
      </div>
      <div class="slide-body" data-panel="custom">
        <h2>Custom</h2>
        <p>Create custom nodes and edit code in a sandbox.</p>
      </div>
      <div class="slide-body" data-panel="settings">
        <h2>Settings</h2>
        <label class="row">Theme
          <select id="setTheme">
            <option value="dark">Dark</option>
            <option value="light">Light</option>
            <option value="high-contrast">High Contrast</option>
          </select>
        </label>
        <label class="row">Grid size
          <input id="setGridSize" type="number" min="4" step="2" value="20">
        </label>
        <label class="row"><input id="setSnap" type="checkbox" checked> Snap to grid</label>
      </div>
    </section>

    <section id="slideout-right" class="slideout right">
      <div class="slide-body" data-panel="history">
        <h2>History</h2>
        <div id="historyList" class="list faint">No edits yet.</div>
      </div>
      <div class="slide-body" data-panel="queue">
        <h2>Queue</h2>
        <div id="queueList" class="list faint">Queue is empty.</div>
      </div>
    </section>

    <!-- Center Stage -->
    <!--
    <section class="stage-wrap" aria-label="Graph editor" tabindex="0" id="stageWrap">
      <div id="stageInner" class="stage-inner">
        <canvas id="gridCanvas" class="grid-canvas" aria-hidden="true"></canvas>
        <canvas id="edgeCanvas" class="edge-canvas" aria-hidden="true"></canvas>
        <div id="nodeLayer" class="node-layer" role="application" aria-roledescription="Node editor"></div>
        <div id="marquee" class="marquee" aria-hidden="true"></div>
        <div id="toast" class="toast" role="status" aria-live="polite"></div>
      </div>

      <div id="minimap" class="minimap" aria-label="Mini map" tabindex="0"></div>
    </section>
    -->
    <section class="stage-wrap" id="stageWrap" tabindex="0" aria-label="Graph editor">
      <!-- Screen-space grid -->
      <canvas id="gridCanvas" class="grid-canvas" aria-hidden="true"></canvas>

      <!-- World: this is the only thing that pans/zooms -->
      <div id="stageInner" class="stage-inner">
        <div id="nodeLayer" class="node-layer" role="application" aria-roledescription="Node editor"></div>
      </div>

      <!-- Screen-space edges -->
      <canvas id="edgeCanvas" class="edge-canvas" aria-hidden="true"></canvas>

      <!-- Screen-space UI -->
      <div id="marquee" class="marquee" aria-hidden="true"></div>
      <div id="minimap" class="minimap" aria-label="Mini map" tabindex="0">
        <canvas id="minimapCanvas"></canvas>
      </div>
      <div id="toast" class="toast" role="status" aria-live="polite"></div>
    </section>
  </main>

  <!-- Bottom Toolbar -->
  <footer class="bottom-bar" role="contentinfo">
    <div class="bar-left">
      <button id="btnRun" class="btn solid">Run</button>
      <button id="btnStop" class="btn">Stop</button>
      <span id="status" class="status">Ready</span>
    </div>
    <div class="bar-center">
      <span class="muted">Graph Floor</span>
      <div class="sep"></div>

      <button id="btnFit" class="btn" title="Fit to Screen">[ ]</button>
      <button id="btnResetZoom" class="btn" title="Reset Zoom">üîÑ</button>

      <div class="sep"></div>

      <button id="zoomOut" class="btn" title="Zoom Out">‚àí</button>
      <span id="zoomPct" class="mono">100%</span>
      <button id="zoomIn" class="btn" title="Zoom In">+</button>

      <div class="sep"></div>

      <button id="btnToggleLinks" class="btn" title="Toggle Wires">üîó</button>
      <button id="btnToggleMinimap" class="btn" title="Toggle Minimap">üó∫Ô∏è</button>
    </div>
    <div class="bar-right">
      <span id="appVersion">v1.2.0</span>
    </div>
  </footer>

  <!-- Delete confirmation modal -->
  <div id="confirmModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="confirmTitle" aria-describedby="confirmDesc">
    <div class="modal-box">
      <h3 id="confirmTitle">Delete node?</h3>
      <p id="confirmDesc">This action cannot be undone.</p>
      <div class="modal-actions">
        <button id="confirmCancel" class="btn">Cancel</button>
        <button id="confirmDelete" class="btn btn-danger"><span class="icon-trash" aria-hidden="true"></span>Delete</button>
      </div>
    </div>
    <div class="modal-backdrop"></div>
  </div>

  <!-- Properties (Inspector) modal -->
  <div id="inspectorModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="inspTitle">
    <div class="modal-box large">
      <h3 id="inspTitle">Properties</h3>
      <form id="inspectorForm" class="inspector-form"></form>
      <div class="modal-actions">
        <button id="inspClose" class="btn">Close</button>
        <button id="inspApply" class="btn solid">Apply</button>
      </div>
    </div>
    <div class="modal-backdrop"></div>
  </div>
  <!-- Context menu root -->
  <div id="ctx-root" aria-hidden="true"></div>

  <!-- App Scripts -->
  <script type="module" src="js/core/store.js"></script>
  <script type="module" src="js/core/plugins.js"></script>
  <script type="module" src="js/core/renderer.js"></script>
  <script type="module" src="js/core/execution.js"></script>
  <script type="module" src="js/core/persistence.js"></script>
  <script type="module" src="js/ui/palette.js"></script>
  <script type="module" src="js/ui/inspector.js"></script>
  <script type="module" src="js/ui/contextmenu.js"></script>
  <script type="module" src="js/nodes/starter.js"></script>
  <script type="module" src="js/app.js"></script>
</body>
</html>
